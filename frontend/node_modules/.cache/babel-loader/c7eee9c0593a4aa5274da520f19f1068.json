{"ast":null,"code":"(function (global, factory) {\n  if ('function' == typeof define && define.amd) define(['exports', 'react', 'prop-types', 'whatkey', './styled-elements'], factory);else if ('undefined' != typeof exports) factory(exports, require('react'), require('prop-types'), require('whatkey'), require('./styled-elements'));else {\n    var mod = {\n      exports: {}\n    };\n    factory(mod.exports, global.React, global.propTypes, global.whatkey, global.styledElements), global.index = mod.exports;\n  }\n})(this, function (exports, _react, _propTypes, _whatkey2, _styledElements) {\n  'use strict';\n\n  function _interopRequireDefault(obj) {\n    return obj && obj.__esModule ? obj : {\n      default: obj\n    };\n  }\n  function _classCallCheck(instance, Constructor) {\n    if (!(instance instanceof Constructor)) throw new TypeError('Cannot call a class as a function');\n  }\n  function _possibleConstructorReturn(self, call) {\n    if (!self) throw new ReferenceError('this hasn\\'t been initialised - super() hasn\\'t been called');\n    return call && ('object' == typeof call || 'function' == typeof call) ? call : self;\n  }\n  function _inherits(subClass, superClass) {\n    if ('function' != typeof superClass && null !== superClass) throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass);\n    subClass.prototype = Object.create(superClass && superClass.prototype, {\n      constructor: {\n        value: subClass,\n        enumerable: !1,\n        writable: !0,\n        configurable: !0\n      }\n    }), superClass && (Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass);\n  }\n  Object.defineProperty(exports, '__esModule', {\n    value: !0\n  });\n  var _class,\n    _temp2,\n    _react2 = _interopRequireDefault(_react),\n    _propTypes2 = _interopRequireDefault(_propTypes),\n    _whatkey3 = _interopRequireDefault(_whatkey2),\n    _extends = Object.assign || function (target) {\n      for (var source, i = 1; i < arguments.length; i++) for (var key in source = arguments[i], source) Object.prototype.hasOwnProperty.call(source, key) && (target[key] = source[key]);\n      return target;\n    },\n    _createClass = function () {\n      function defineProperties(target, props) {\n        for (var descriptor, i = 0; i < props.length; i++) descriptor = props[i], descriptor.enumerable = descriptor.enumerable || !1, descriptor.configurable = !0, 'value' in descriptor && (descriptor.writable = !0), Object.defineProperty(target, descriptor.key, descriptor);\n      }\n      return function (Constructor, protoProps, staticProps) {\n        return protoProps && defineProperties(Constructor.prototype, protoProps), staticProps && defineProperties(Constructor, staticProps), Constructor;\n      };\n    }(),\n    Content = (_temp2 = _class = function (_Component) {\n      function Content() {\n        var _ref, _temp, _this, _ret;\n        _classCallCheck(this, Content);\n        for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) args[_key] = arguments[_key];\n        return _ret = (_temp = (_this = _possibleConstructorReturn(this, (_ref = Content.__proto__ || Object.getPrototypeOf(Content)).call.apply(_ref, [this].concat(args))), _this), _this.state = {\n          summary: [],\n          promptPrefix: '',\n          prompt: '>',\n          history: [],\n          historyCounter: 0,\n          input: [],\n          keyInputs: [],\n          canScroll: !0,\n          controller: null\n        }, _this.componentWillMount = function () {\n          var data = _this.context.instances.find(function (i) {\n              return i.index === _this.props.id;\n            }),\n            state = {\n              prompt: _this.props.prompt\n            };\n          data && (state = _extends({}, state, data.oldData)), _this.setState(state);\n        }, _this.componentDidMount = function () {\n          _this.focusInput();\n          var data = _this.context.instances.find(function (i) {\n            return i.index === _this.props.id;\n          });\n          _this.unregister = _this.props.register(_this), data && 0 !== Object.keys(data.oldData).length || _this.handleChange({\n            target: {\n              value: 'show'\n            },\n            key: 'Enter',\n            dontShowCommand: !0\n          });\n        }, _this.componentDidUpdate = function () {\n          null !== _this.inputWrapper && _this.inputWrapper.scrollIntoView(!1);\n        }, _this.setScrollPosition = function (pos) {\n          setTimeout(function () {\n            null !== _this.contentWrapper && (_this.contentWrapper.scrollTop = pos);\n          }, 50);\n        }, _this.focusInput = function () {\n          null !== _this.com && _this.com.focus();\n        }, _this.handleChange = function (e) {\n          _this.props.handleChange(_this, e);\n        }, _this.handleKeyPress = function (e) {\n          _this.props.handlerKeyPress(_this, e, _this.com);\n        }, _this.handleOuterKeypress = function (e) {\n          var _whatkey = (0, _whatkey3.default)(e),\n            key = _whatkey.key;\n          0 > _whatkey2.unprintableKeys.indexOf(key) ? document.activeElement !== _this.com && (_this.com.focus(), _this.com.value += (0, _whatkey3.default)(e).char) : -1 < ['up', 'down', 'left', 'right', 'enter'].indexOf(key) && _this.com.focus();\n        }, _temp), _possibleConstructorReturn(_this, _ret);\n      }\n      return _inherits(Content, _Component), _createClass(Content, [{\n        key: 'componentWillUnmount',\n        value: function () {\n          this.unregister(this.state);\n        }\n      }, {\n        key: 'render',\n        value: function () {\n          var _this2 = this,\n            id = this.props.id,\n            _context = this.context,\n            maximise = _context.maximise,\n            activeTab = _context.activeTab,\n            barShowing = _context.barShowing,\n            tabsShowing = _context.tabsShowing;\n          if (id !== activeTab) return null;\n          var output = this.state.summary.map(function (content, i) {\n              return 'string' == typeof content && 0 === content.length ? _react2.default.createElement(_styledElements.OutputLine, {\n                key: i\n              }, '\\xA0') : _react2.default.createElement(_styledElements.PreOutputLine, {\n                key: i\n              }, Array.isArray(content) ? content.map(function (cont, key) {\n                return _react2.default.createElement('span', {\n                  style: {\n                    marginRight: 5\n                  },\n                  key: 'inner-' + key\n                }, cont);\n              }) : content);\n            }),\n            toSubtract = 30;\n          return barShowing || (toSubtract -= 30), tabsShowing && (toSubtract += 30), _react2.default.createElement(_styledElements.ContainerMain, {\n            style: _extends({}, maximise ? {\n              maxWidth: '100%',\n              maxHeight: 'calc(100% - ' + toSubtract + 'px)'\n            } : {}, this.state.canScroll ? {\n              overflowY: 'auto'\n            } : {\n              overflowY: 'hidden'\n            }),\n            tabIndex: '0',\n            onKeyUp: this.handleOuterKeypress,\n            innerRef: function (ctw) {\n              _this2.contentWrapper = ctw;\n            }\n          }, _react2.default.createElement(_styledElements.Holder, null, _react2.default.createElement(_styledElements.ContainerContent, null, _react2.default.createElement(_styledElements.InputArea, null, output, _react2.default.createElement(_styledElements.Input, {\n            innerRef: function (elm) {\n              _this2.inputWrapper = elm;\n            }\n          }, _react2.default.createElement(_styledElements.Prompt, null, this.state.promptPrefix + this.state.prompt), _react2.default.createElement(_styledElements.MainInput, {\n            type: 'text',\n            tabIndex: '-1',\n            innerRef: function (com) {\n              _this2.com = com;\n            },\n            onKeyPress: this.handleChange,\n            onKeyDown: this.handleKeyPress\n          }))))));\n        }\n      }]), Content;\n    }(_react.Component), _class.displayName = 'Content', _class.propTypes = {\n      id: _propTypes2.default.string,\n      oldData: _propTypes2.default.object,\n      prompt: _propTypes2.default.string,\n      register: _propTypes2.default.func,\n      handleChange: _propTypes2.default.func,\n      handlerKeyPress: _propTypes2.default.func.isRequired\n    }, _class.defaultProps = {\n      prompt: '>',\n      oldData: {}\n    }, _class.contextTypes = {\n      maximise: _propTypes2.default.bool,\n      instances: _propTypes2.default.array,\n      activeTab: _propTypes2.default.string,\n      barShowing: _propTypes2.default.bool,\n      tabsShowing: _propTypes2.default.bool\n    }, _temp2);\n  exports.default = Content;\n});","map":{"version":3,"mappings":"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","names":["Content","state","summary","promptPrefix","prompt","history","historyCounter","input","keyInputs","canScroll","controller","componentWillMount","data","_this","context","instances","find","i","index","props","id","oldData","setState","componentDidMount","focusInput","unregister","register","keys","length","handleChange","target","value","key","dontShowCommand","componentDidUpdate","inputWrapper","scrollIntoView","setScrollPosition","pos","setTimeout","contentWrapper","scrollTop","com","focus","e","handleKeyPress","handlerKeyPress","handleOuterKeypress","indexOf","document","activeElement","char","_context","maximise","activeTab","barShowing","tabsShowing","output","map","content","_react2","Array","isArray","cont","style","marginRight","toSubtract","maxWidth","maxHeight","overflowY","tabIndex","onKeyUp","innerRef","ctw","_this2","elm","type","onKeyPress","onKeyDown","displayName","propTypes","_propTypes2","string","object","func","isRequired","defaultProps","contextTypes","bool","array"],"sources":["../../../../src/js/components/Content/index.js"],"sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport whatkey, { unprintableKeys } from 'whatkey';\nimport {\n  ContainerMain, ContainerContent, Holder,\n  Input, InputArea, MainInput,\n  OutputLine, PreOutputLine, Prompt,\n} from './styled-elements';\n\nclass Content extends Component {\n  static displayName = 'Content';\n\n  static propTypes = {\n    id: PropTypes.string,\n    oldData: PropTypes.object, // eslint-disable-line\n    prompt: PropTypes.string,\n    register: PropTypes.func,\n    handleChange: PropTypes.func,\n    handlerKeyPress: PropTypes.func.isRequired,\n  };\n\n  static defaultProps = {\n    prompt: '>',\n    oldData: {},\n  };\n\n  static contextTypes = {\n    maximise: PropTypes.bool,\n    instances: PropTypes.array,\n    activeTab: PropTypes.string,\n    barShowing: PropTypes.bool,\n    tabsShowing: PropTypes.bool,\n  };\n\n  state = {\n    summary: [],\n    promptPrefix: '',\n    prompt: '>',\n    history: [],\n    historyCounter: 0,\n    input: [],\n    keyInputs: [],\n    canScroll: true,\n    controller: null,\n  };\n\n  componentWillMount = () => {\n    const data = this.context.instances.find(i => i.index === this.props.id);\n    let state = { prompt: this.props.prompt };\n    if (data) {\n      state = { ...state, ...data.oldData };\n    }\n    this.setState(state);\n  };\n\n  componentDidMount = () => {\n    this.focusInput();\n    const data = this.context.instances.find(i => i.index === this.props.id);\n    this.unregister = this.props.register(this);\n    if (!data || Object.keys(data.oldData).length === 0) {\n      this.handleChange({ target: { value: 'show' }, key: 'Enter', dontShowCommand: true });\n    }\n  };\n\n  // Adjust scrolling\n  componentDidUpdate = () => {\n    if (this.inputWrapper !== null) {\n      this.inputWrapper.scrollIntoView(false);\n    }\n  };\n\n  componentWillUnmount() {\n    this.unregister(this.state);\n  }\n\n  setScrollPosition = (pos) => {\n    setTimeout(() => {\n      if (this.contentWrapper !== null) {\n        this.contentWrapper.scrollTop = pos;\n      }\n    }, 50);\n  };\n\n  focusInput = () => {\n    if (this.com !== null) {\n      this.com.focus();\n    }\n  };\n\n  handleChange = (e) => {\n    this.props.handleChange(this, e);\n  }\n\n  handleKeyPress = (e) => {\n    this.props.handlerKeyPress(this, e, this.com);\n  }\n\n  handleOuterKeypress = (e) => {\n    const { key } = whatkey(e);\n    const actionKeys = ['up', 'down', 'left', 'right', 'enter'];\n    if (unprintableKeys.indexOf(key) < 0) {\n      if (document.activeElement !== this.com) {\n        this.com.focus();\n        this.com.value += whatkey(e).char;\n      }\n    } else if (actionKeys.indexOf(key) > -1) {\n      this.com.focus();\n    }\n  }\n\n  render() {\n    const { id } = this.props;\n    const {\n      maximise, activeTab, barShowing, tabsShowing,\n    } = this.context;\n\n    if (id !== activeTab) {\n      return null;\n    }\n\n    const output = this.state.summary.map((content, i) => {\n      if (typeof content === 'string' && content.length === 0) {\n        return <OutputLine key={i}>&nbsp;</OutputLine>;\n      }\n      return (\n        <PreOutputLine key={i}>\n          {\n            Array.isArray(content) ?\n            content.map((cont, key) => (\n              <span style={{ marginRight: 5 }} key={`inner-${key}`}>{cont}</span>\n            )) :\n            content\n          }\n        </PreOutputLine>\n      );\n    });\n\n    let toSubtract = 30;\n    if (!barShowing) {\n      toSubtract -= 30;\n    }\n    if (tabsShowing) {\n      toSubtract += 30;\n    }\n\n    return (\n      <ContainerMain\n        style={{\n          ...(maximise\n            ? { maxWidth: '100%', maxHeight: `calc(100% - ${toSubtract}px)` }\n            : {}),\n          ...(this.state.canScroll\n            ? { overflowY: 'auto' }\n            : { overflowY: 'hidden' }),\n        }}\n        tabIndex=\"0\"\n        onKeyUp={this.handleOuterKeypress}\n        innerRef={(ctw) => { this.contentWrapper = ctw; }}\n      >\n        <Holder>\n          <ContainerContent>\n            <InputArea>\n              {output}\n              <Input\n                innerRef={(elm) => { this.inputWrapper = elm; }}\n              >\n                <Prompt>\n                  {this.state.promptPrefix + this.state.prompt}\n                </Prompt>\n                <MainInput\n                  type=\"text\"\n                  tabIndex=\"-1\"\n                  innerRef={(com) => { this.com = com; }}\n                  onKeyPress={this.handleChange}\n                  onKeyDown={this.handleKeyPress}\n                />\n              </Input>\n            </InputArea>\n          </ContainerContent>\n        </Holder>\n      </ContainerMain>\n    );\n  }\n}\n\nexport default Content;\n"]},"metadata":{},"sourceType":"script"}